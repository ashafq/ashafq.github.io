
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs'; </script>


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/lovelace.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">

  <link href="https://shafq.at/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ayan Shafqat Atom">









<meta name="author" content="Ayan Shafqat" />
<meta name="description" content="Having a problem-solving mindset is incredibly valuable and rewarding, especially when it leads to exciting DIY adventures. My latest experience with a noisy GPU fan turned into just such an opportunity. It guided me through fascinating explorations involving ATX power, MOSFET motor drivers, Pulse Width Modulation (PWM), ATTiny85&#39;s bit-banged 1-wire â€¦" />
<meta name="keywords" content="firmware, hardware, tech, C, pwm, attiny85, fan">


  <meta property="og:site_name" content="Ayan Shafqat"/>
  <meta property="og:title" content="My GPU Fan Saga"/>
  <meta property="og:description" content="Having a problem-solving mindset is incredibly valuable and rewarding, especially when it leads to exciting DIY adventures. My latest experience with a noisy GPU fan turned into just such an opportunity. It guided me through fascinating explorations involving ATX power, MOSFET motor drivers, Pulse Width Modulation (PWM), ATTiny85&#39;s bit-banged 1-wire â€¦"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./my-gpu-fan-saga.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-07-21 00:00:00-04:00"/>
  <meta property="article:modified_time" content="2025-07-21 00:00:00-04:00"/>
  <meta property="article:author" content="./author/ayan-shafqat.html">
  <meta property="article:section" content="Programming"/>
  <meta property="article:tag" content="firmware"/>
  <meta property="article:tag" content="hardware"/>
  <meta property="article:tag" content="tech"/>
  <meta property="article:tag" content="C"/>
  <meta property="article:tag" content="pwm"/>
  <meta property="article:tag" content="attiny85"/>
  <meta property="article:tag" content="fan"/>
  <meta property="og:image" content="/images/profile.png">

  <title>Ayan Shafqat &ndash; My GPU Fan Saga</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="/images/profile.png" alt="Ayan Shafqat" title="Ayan Shafqat">
    </a>

    <h1>
      <a href="./">Ayan Shafqat</a>
    </h1>

    <p>My personal website</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="./pages/about.html#about">
                About
              </a>
            </li>
            <li>
              <a target="_self"
                 href="./pages/papers.html#papers">
                Papers
              </a>
            </li>

      </ul>
    </nav>

    <div style="margin: 0; padding: 0;">
      <iframe
        src="https://github.com/sponsors/ashafq/button"
        title="Sponsor ashafq"
        height="32"
        width="114"
        style="border: 0; border-radius: 10px;"
      ></iframe>
    </div>

    <div style="margin: 0; padding: 10px;">
      <a href='https://ko-fi.com/ashafq'
         target='_blank'>
        <img height='36'
            style='border:0px; height:36px; border-radius: 0px;'
            src='https://storage.ko-fi.com/cdn/kofi6.png?v=6'
            border='0'
            alt='Buy Me a Coffee at ko-fi.com' />
      </a>
    </div>

    <div style="margin: 0; padding: 10px;">
    <ul class="social">
      <li>
        <a class="sc-envelope"
rel="me"           href="mailto:ayan.x.shafqat@gmail.com"
           target="_blank">
          <i class="fa-solid fa-envelope"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/ashafq"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-stack-overflow"
           href="http://stackoverflow.com/users/6744189/ayan-shafqat"
           target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/ayanshafqat"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://hachyderm.io/@ashafq"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="https://shafq.at/feeds/all.atom.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
    </div>
  </div>

</aside>
  <main>

<nav>
  <a href="./">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="https://shafq.at/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="my-gpu-fan-saga">My GPU Fan Saga</h1>
    <p>
      Posted on Mon 21 July 2025 in <a href="./category/programming.html">Programming</a>

    </p>
  </header>


  <div>
    <p>Having a problem-solving mindset is incredibly valuable and rewarding, especially when it leads to exciting DIY adventures. My latest experience with a noisy GPU fan turned into just such an opportunity. It guided me through fascinating explorations involving ATX power, MOSFET motor drivers, Pulse Width Modulation (PWM), ATTiny85's bit-banged 1-wire bus, and a DS18B20 temperature sensor. While many ready-made solutions exists, this project provided me with invaluable learning and immense satisfaction. ðŸ˜Š</p>
<p><img src="https://codeberg.org/Colahall/tiny85fancontrol/media/branch/main/schematic/info/tiny85fancontrol.png" alt="Tiny85 Fan Controller PCB 3D previes" width=500px></p>
<h2>Background</h2>
<p>The GPU in question isn't particularly high-end, nor is the use case too demanding. I use this <a href="https://visiontek.com/products/radeon-rx-550-sff-4gb-gddr5-4m-graphics-card-4x-mdp">VisionTek Radeon RX 550 SFF GDDR5 </a> mainly because it supports Wayland on Linux. Nvidia, on the other hand, has great support for Linux, only if you're running CUDA. So, my setup has been to use Nvidia for CUDA/ML related tasks and AMD for Wayland. But last winter, my AMD graphics card decided to annoy me with a high-pitched whine, a clear sign that the fan was nearing its end. To prevent further damage (or perhaps just out of sheer annoyance), I swiftly snipped the fan's power cable. Silence returned, and through the cold months, the GPU seemed perfectly fine without active cooling.</p>
<p>That blissful silence lasted until May. With rising temperatures, my GPU began to complain again, this time visually. The screen started having episodes of random flickers and periodic blackouts. At idle, the GPU temperature hovered around 80 Â°C, clearly unhealthy no matter how modest its workload. It was obvious that a solution was needed, preferably one that wouldn't break the bank.</p>
<h2>Solution Part 1: Using an Old Fan</h2>
<p>Being a long-time tinkerer, I typically have random spare parts lying around. Among these was a small 12V DC brushless fan from a past project. Unfortunately, the connectors didn't match. Undeterred, I stripped a spare Molex connector and wired it up. If you're curious, Wikipedia offers great documentation on <a href="https://en.wikipedia.org/wiki/Molex_connector">Molex connectors</a> pinout and I have confirmed them with my own measurements as well. Here is a quick reference on the pinout:</p>
<table>
<thead>
<tr>
<th>Pin</th>
<th><strong>Color</strong></th>
<th><strong>Type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Pin 1</td>
<td>Yellow</td>
<td>+12Â V</td>
</tr>
<tr>
<td>Pin 2</td>
<td>Black</td>
<td>Ground</td>
</tr>
<tr>
<td>Pin 3</td>
<td>Black</td>
<td>Ground</td>
</tr>
<tr>
<td>Pin 4</td>
<td>Red</td>
<td>+5Â V</td>
</tr>
</tbody>
</table>
<p>I mounted the fan onto the GPU with some double-sided tape, right under the defunct fan. Initially, it seemed perfect: the GPU temperature dropped significantly; hovering around 40 Â°C even under load. But a new issue emerged: the fan ran at full speed constantly, turning my workspace from a serene environment back into a slightly noisier one.</p>
<h2>Solution Part 2: Pulse Width Modulation (PWM)</h2>
<p>PWM is used everywhere. From dimming LED lights and creating powerful yet efficient audio amplifiers to voltage regulation for large power convertors. It's a very simple concept build on many complex ideas. Sure, I could have powered the fan from the 5V rail of the Molex connector, but this brought two issues: first, the fan required a higher voltage to initially start spinning; second, even if it did run at 5V, the speed might be insufficient to keep the GPU cool enough.</p>
<p>There are many ways to generate a PWM signal. In analog world, it can be achieved with a <a href="https://en.wikipedia.org/wiki/555_timer_IC">555 timer IC</a>. But, I had my eyes set for a more complex approach, which is by using a cheap microcontroller. Luckily, I have a bunch of <a href="https://www.microchip.com/en-us/product/ATtiny85">ATtiny85</a> laying around ready to be used. Using a microcontroller allows us to add a bit of logic to the PWM, which we will explore in the next section. PWM can be generated by using timer registers on the ATtiny, and can be explored in the code on <a href="https://github.com/Colahall/tiny85fancontrol/blob/main/src/pwm.c#L32">Github</a> or <a href="https://codeberg.org/Colahall/tiny85fancontrol/src/branch/main/src/pwm.c#L32">Codeberg</a>.</p>
<h2>Solution Part 3: Automatically Adjust Fan Speed Based on Temperature</h2>
<p><a href="https://www.analog.com/en/products/ds18b20.html">DS18B20</a> may seem like a mouthful, nor does it roll of the tongue easily. However, with enough practice, we can recite these characters, which incidentally look like a solid low-entropy password. Jokes aside, this is one of the most widely-used temperature sensors in hobby electronics, commonly included in many beginner electronics kits. I also just happen to have a few of these in my parts bin.</p>
<p>The DS18B20 sensor communicates using the <a href="https://en.wikipedia.org/wiki/1-Wire">1-Wire</a> bus protocol, which is somewhat similar, in principle, to the <a href="https://en.wikipedia.org/wiki/LED_strip_light">WS2812</a> (another tongue-twister!) addressable RGB LEDs, albeit slightly more complicated. While the 1-Wire bus resembles <a href="https://en.wikipedia.org/wiki/I2C">IÂ²C</a>, it has its own unique quirks. Plenty of excellent tutorials cover the nuances of interfacing with DS18B20, so Iâ€™ll leave the detailed exploration of the protocol as an exercise for interested readers. In my case, I mostly mashed the keyboard until I started receiving accurate temperature readings.</p>
<p>For a detailed explanation of the temperature sensor, please check the data sheet of <a href="https://www.analog.com/en/products/ds18b20.html">DS18B20</a>. Also, there are other temperature sensors out there that uses simpler protocols, such as:</p>
<ul>
<li>
<p><strong>HTU31</strong>: Measures both temperature and humidity via <strong>IÂ²C</strong>. <a href="https://www.te.com/usa-en/product-10142048-20.datasheet.pdf">Datasheet</a>.</p>
</li>
<li>
<p><strong>BME688</strong>: Provides temperature, humidity, barometric pressure, and gas sensing (e.g., carbon monoxide) also via <strong>IÂ²C</strong>. <a href="https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme688-ds000.pdf">Datasheet</a>.</p>
</li>
<li>
<p><strong>TMP35/36/37</strong>: Simplest analog sensors, easily read with an Analog-to-Digital Converter (ADC). <a href="https://www.analog.com/media/en/technical-documentation/data-sheets/TMP35_36_37.pdf">Datasheet</a>.</p>
</li>
</ul>
<h2>Results</h2>
<p>No fancy graphs, just vibes.Â <strong>Solution PartÂ 1</strong>Â (manual fan replacement) immediately eliminated flickers, lowering the GPUâ€™s idle temperature to aroundÂ <strong>35â€¯Â°C</strong>Â and peak load temperature toÂ <strong>40â€¯Â°C</strong>. The downside: the fan ran at full blast continuously, creating noticeable noise.</p>
<p>With the introduction of temperature-based PWM control (<strong>Solution PartÂ 2Â &amp;Â 3</strong>), idle temperatures settled aroundÂ <strong>40â€¯Â°C</strong>, with peaks nearÂ <strong>60â€¯Â°C</strong>Â under sustained heavy load, well within safe operating limits. Crucially, the fan now remains whisperâ€‘quiet at typical room temperatures, ramping up speed only when required.</p>
<h2>Costs</h2>
<p>While my time investment was significant, the <em>material</em> costs remain modest when parts are ordered in bulk. Hereâ€™s a breakdown of the bill of materials:</p>
<table>
<thead>
<tr>
<th><strong>Reference</strong></th>
<th><strong>Qty</strong></th>
<th><strong>Value</strong></th>
<th><strong>Unit Cost (10 pcs)</strong></th>
<th><strong>Unit Cost (100 pcs)</strong></th>
<th><strong>Footprint</strong></th>
<th><strong>Datasheet</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>C1</td>
<td>1</td>
<td>0.1 ÂµF</td>
<td>&#36;0.10</td>
<td>&#36;0.07</td>
<td>Capacitor_THT:CP_Radial_D4.0mm_P2.00mm</td>
<td>â€”</td>
</tr>
<tr>
<td>D1</td>
<td>1</td>
<td>1N4001</td>
<td>&#36;0.07</td>
<td>&#36;0.05</td>
<td>Diode_THT:D_DO-41_SOD81_P10.16mm_Horizontal</td>
<td>http://www.vishay.com/docs/88503/1n4001.pdf</td>
</tr>
<tr>
<td>J1</td>
<td>1</td>
<td>UART_DBG</td>
<td>&#36;0.50</td>
<td>&#36;0.10</td>
<td>Connector_PinHeader_2.54mm:PinHeader_1x02_P2.54mm_Vertical</td>
<td>â€”</td>
</tr>
<tr>
<td>J2</td>
<td>1</td>
<td>Molex</td>
<td>&#36;1.00</td>
<td>&#36;0.20</td>
<td>Connector_Molex:Molex_KK-254_AE-6410-04A_1x04_P2.54mm_Vertical</td>
<td>â€”</td>
</tr>
<tr>
<td>M1</td>
<td>1</td>
<td>Fan Connector</td>
<td>&#36;5.00</td>
<td>&#36;2.00</td>
<td>Connector_PinHeader_2.54mm:PinHeader_1x02_P2.54mm_Vertical</td>
<td>â€”</td>
</tr>
<tr>
<td>Q1</td>
<td>1</td>
<td>IRF3808</td>
<td>&#36;1.59</td>
<td>&#36;1.00</td>
<td>Package_TO_SOT_THT:TO-220-3_Vertical</td>
<td>http://www.irf.com/product-info/datasheets/data/irf3205.pdf</td>
</tr>
<tr>
<td>R1</td>
<td>1</td>
<td>10 kÎ©</td>
<td>&#36;0.02</td>
<td>&#36;0.01</td>
<td>Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P1.90mm_Vertical</td>
<td>â€”</td>
</tr>
<tr>
<td>R2</td>
<td>1</td>
<td>100 Î©</td>
<td>&#36;0.36</td>
<td>&#36;0.25</td>
<td>Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P1.90mm_Vertical</td>
<td>Can be short to save that money</td>
</tr>
<tr>
<td>R3</td>
<td>1</td>
<td>4.7 kÎ©</td>
<td>&#36;0.05</td>
<td>&#36;0.02</td>
<td>Resistor_THT:R_Axial_DIN0204_L3.6mm_D1.6mm_P1.90mm_Vertical</td>
<td>â€”</td>
</tr>
<tr>
<td>U1</td>
<td>1</td>
<td>ATtiny85-20P</td>
<td>&#36;1.66</td>
<td>&#36;1.50</td>
<td>Package_DIP:DIP-8_W7.62mm</td>
<td>http://ww1.microchip.com/downloads/en/DeviceDoc/atmel-2586-avr-8-bit-microcontroller-attiny25-attiny45-attiny85_datasheet.pdf</td>
</tr>
<tr>
<td>U2</td>
<td>1</td>
<td>DS18B20</td>
<td>&#36;5.70</td>
<td>&#36;1.20</td>
<td>Package_TO_SOT_THT:TO-92_Inline</td>
<td>http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf</td>
</tr>
</tbody>
</table>
<p>Total material cost per unit is &#36;6.40â€“&#36;16.05, plus an additional &#36;5.00 PCB fabrication fee form <a href="https://oshpark.com/">OSHPark</a> (Based on 1 inÂ² quote). This can be reduced further with using SMD components, and a cheaper microcontroller. Not too bad for a few hours of prototype work.</p>
<h2>Conclusion</h2>
<p>Was this project valuable? If youâ€™re looking purely at dollars spent versus performance gained, a commercial fan controller might be cheaper. But the journey taught me more about microcontroller, power electronics, and firmware design than any off-the-shelf unit could. The satisfaction of a custom solution, silent, temperature-aware, and built by handsâ€”makes it worth every penny (and every line of code).</p>
<p>Whether you embark on a similar adventure or opt for a plug-and-play controller, I hope this story inspires your next DIY challenge. Happy tinkering!</p>
<hr>
<p><strong>If you found this project valuable, check out the fully open-sourced code and PCB files on <a href="https://github.com/Colahall/tiny85fancontrol">GitHub</a> and <a href="https://codeberg.org/Colahall/tiny85fancontrol">Codeberg</a>.</strong> I'm planning to add new featuresâ€”like advanced fan profiles and UI integrationâ€”if thereâ€™s interest. Additionally, I can develop a more cost-effective version using a cheaper microcontroller to further reduce BOM costs, so let me know if thatâ€™s something youâ€™d like to see!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/firmware.html">firmware</a>
      <a href="./tag/hardware.html">hardware</a>
      <a href="./tag/tech.html">tech</a>
      <a href="./tag/c.html">C</a>
      <a href="./tag/pwm.html">pwm</a>
      <a href="./tag/attiny85.html">attiny85</a>
      <a href="./tag/fan.html">fan</a>
    </p>
  </div>






</article>

<footer>
  <p>All opinions expressed on this site are solely my own and do not necessarily reflect the views or opinions of my current or former employers.</p>

<p>
  &copy; 2017-2025 Ayan Shafqat  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ayan Shafqat ",
  "url" : ".",
  "image": "/images/profile.png",
  "description": "Personal website of Ayan Shafqat"
}
</script>
</body>
</html>